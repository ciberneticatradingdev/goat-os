---
// GOAT-OS Desktop Component - Greatest OS All Time
import Taskbar from './Taskbar.astro';
import StartMenu from './StartMenu.astro';
import ApplicationWindows from './ApplicationWindows.astro';
// CommunicationHub removed - now handled through ApplicationWindows system
---

<!-- GOAT-OS Main Desktop - Retro Memecoin Operating System -->
<div id="main-screen" class="hidden min-h-screen bg-[url('/goat.gif')] bg-left bg-cover w-screen relative overflow-hidden">
  
  <!-- Dynamic Background with Floating Goats -->
  <div class="absolute inset-0 overflow-hidden">
    <img src="/dancing-goat.gif" class="absolute animate-goat-1 w-16 h-16 opacity-80" alt="Dancing Goat" />
    <img src="/goat.gif" class="absolute animate-goat-2 w-20 h-20 opacity-60" alt="Goat" />
  </div>

  <!-- GOAT-OS Lore Panel -->
  <div id="lore-panel" class="absolute top-4 left-4 bg-black/80 text-green-400 p-2 rounded-lg border border-green-500 max-w-2xl font-mono text-[9px] backdrop-blur-sm z-50">
    <div class="flex items-center mb-2">
      <img src="/goatoswhite.png" class="w-8 h-8 mr-2" alt="GOAT-OS Logo" />
      <h2 class="text-yellow-400 text-[10px] font-bold mb-1 typing-text">GOAT-OS v1.337</h2>
    </div>
    <div class="typing-text">
      <p class="mb-1 typing-text text-xs">Welcome to the Greatest Operating System of All Time!</p>
      <p class="mb-1 typing-text text-xs">Born from the depths of memecoin culture and powered by pure autism.</p>
      <p class="mb-2 typing-text text-xs">Legend says this OS was coded by a legendary developer who only trades shitcoins.</p>
      <p class="text-yellow-400 font-bold typing-text text-[9px]">Current Meme Level: MAXIMUM</p>
    </div>
  </div>

  <!-- Desktop Icons Grid - Communication Hub icon removed -->
  <div class="absolute top-4 right-4 flex flex-col space-y-4 z-40">
    <!-- Desktop icons can be added here if needed -->
  </div>

  <!-- GOAT GIF Windows -->
  <div class="fixed inset-4 pointer-events-none z-30 overflow-hidden">
    <!-- Goat Window 1 -->
    <div class="goat-window absolute top-4 right-4 w-64 h-48 bg-white border-2 border-black shadow-lg pointer-events-auto animate-float-1">
      <div class="bg-gray-200 border-b-2 border-black p-2 flex justify-between items-center">
        <span class="text-black font-bold text-sm">🌈 Psychedelic GOAT</span>
        <button onclick="closeGoatWindow(this)" class="text-black hover:text-red-600 font-bold">✕</button>
      </div>
      <div class="p-2 h-full flex items-center justify-center bg-gradient-to-br from-blue-100 to-purple-100">
        <img src="/goat.gif" alt="Classic GOAT" class="max-w-full max-h-full object-contain rounded" />
      </div>
    </div>

    <!-- Dancing Goat Window -->
    <div class="goat-window absolute top-64 right-4 w-64 h-48 bg-white border-2 border-black shadow-lg pointer-events-auto animate-float-2">
      <div class="bg-gray-200 border-b-2 border-black p-2 flex justify-between items-center">
        <span class="text-black font-bold text-sm">💃 Dancing GOAT</span>
        <button onclick="closeGoatWindow(this)" class="text-black hover:text-red-600 font-bold">✕</button>
      </div>
      <div class="p-2 h-full flex items-center justify-center bg-gradient-to-br from-pink-100 to-yellow-100">
        <img src="/dancing-goat.gif" alt="Dancing GOAT" class="max-w-full max-h-full object-contain rounded" />
      </div>
    </div>

    <!-- Goat2 Window -->
    <div class="goat-window absolute bottom-32 left-8 w-64 h-48 bg-white border-2 border-black shadow-lg pointer-events-auto animate-float-3">
      <div class="bg-gray-200 border-b-2 border-black p-2 flex justify-between items-center">
        <span class="text-black font-bold text-sm">🌟 GOAT Supreme</span>
        <button onclick="closeGoatWindow(this)" class="text-black hover:text-red-600 font-bold">✕</button>
      </div>
      <div class="p-2 h-full flex items-center justify-center bg-gradient-to-br from-green-100 to-blue-100">
        <img src="/goat2.gif" alt="GOAT Supreme" class="max-w-full max-h-full object-contain rounded" />
      </div>
    </div>

    <!-- Goat4 Window -->
    <div class="goat-window absolute bottom-32 right-80 w-64 h-48 bg-white border-2 border-black shadow-lg pointer-events-auto animate-float-4">
      <div class="bg-gray-200 border-b-2 border-black p-2 flex justify-between items-center">
        <span class="text-black font-bold text-sm">🚀 Mega GOAT</span>
        <button onclick="closeGoatWindow(this)" class="text-black hover:text-red-600 font-bold">✕</button>
      </div>
      <div class="p-2 h-full flex items-center justify-center bg-gradient-to-br from-yellow-100 to-orange-100">
        <img src="/goat4.gif" alt="Mega GOAT" class="max-w-full max-h-full object-contain rounded" />
      </div>
    </div>

    <!-- Troll Window -->
    <div class="goat-window absolute bottom-32 right-8 w-64 h-48 bg-white border-2 border-black shadow-lg pointer-events-auto animate-float-5">
      <div class="bg-gray-200 border-b-2 border-black p-2 flex justify-between items-center">
        <span class="text-black font-bold text-sm">😈 Troll GOAT</span>
        <button onclick="closeGoatWindow(this)" class="text-black hover:text-red-600 font-bold">✕</button>
      </div>
      <div class="p-2 h-full flex items-center justify-center bg-gradient-to-br from-purple-100 to-pink-100">
        <img src="/troll.gif" alt="Troll GOAT" class="max-w-full max-h-full object-contain rounded" />
      </div>
    </div>
  </div>



  <!-- Easter Egg: Secret Goat -->
  <div class="absolute bottom-20 left-10 cursor-pointer" onclick="triggerEasterEgg()">
    <img src="/goatos2.png" class="w-8 h-8 opacity-30 hover:opacity-100 transition-opacity" alt="Secret Goat" />
  </div>

  <!-- Taskbar -->
  <Taskbar />
  
  <!-- Start Menu -->
  <StartMenu />
  
  <!-- Communication Hub removed - now handled through ApplicationWindows system -->
  
  <!-- Application Windows -->
  <ApplicationWindows />

</div>

<style>
  @keyframes goatMove {
    0% { left: -60px; }
    100% { left: calc(100% + 60px); }
  }

  @keyframes goatFloat1 {
    0% { transform: translate(0, 0) rotate(0deg); }
    25% { transform: translate(100px, -50px) rotate(90deg); }
    50% { transform: translate(200px, 0) rotate(180deg); }
    75% { transform: translate(100px, 50px) rotate(270deg); }
    100% { transform: translate(0, 0) rotate(360deg); }
  }

  @keyframes goatFloat2 {
    0% { transform: translate(100vw, 0) rotate(0deg); }
    25% { transform: translate(75vw, -100px) rotate(-90deg); }
    50% { transform: translate(50vw, 0) rotate(-180deg); }
    75% { transform: translate(25vw, 100px) rotate(-270deg); }
    100% { transform: translate(0, 0) rotate(-360deg); }
  }

  @keyframes trollBounce {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-20px) scale(1.1); }
  }

  @keyframes typing {
    from { width: 0; }
    to { width: 100%; }
  }

  .animate-goat {
    animation: goatMove 8s linear infinite;
  }

  .animate-goat-1 {
    animation: goatFloat1 15s ease-in-out infinite;
    top: 20%;
    left: 10%;
  }

  .animate-goat-2 {
    animation: goatFloat2 20s ease-in-out infinite;
    top: 60%;
    right: 10%;
  }

  .animate-troll {
    animation: trollBounce 3s ease-in-out infinite;
    top: 40%;
    left: 50%;
  }

  .typing-text {
    overflow: hidden;
    border-right: 1px solid #00ff00;
    white-space: nowrap;
    animation: typing 4s steps(40, end), blink-caret 1s step-end infinite;
  }

  @keyframes blink-caret {
    from, to { border-color: transparent; }
    50% { border-color: #00ff00; }
  }

  .desktop-icon:hover {
    transform: scale(1.1);
  }

  .desktop-icon {
    transition: transform 0.2s ease;
  }

  /* GOAT Window Animations */
  @keyframes float-1 {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-15px) rotate(2deg); }
  }

  @keyframes float-2 {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(-2deg); }
  }

  @keyframes float-3 {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(1deg); }
  }

  @keyframes float-4 {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-25px) rotate(-1deg); }
  }

  @keyframes float-5 {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-18px) rotate(3deg); }
  }

  .animate-float-1 {
    animation: float-1 4s ease-in-out infinite;
  }

  .animate-float-2 {
    animation: float-2 5s ease-in-out infinite 0.5s;
  }

  .animate-float-3 {
    animation: float-3 6s ease-in-out infinite 1s;
  }

  .animate-float-4 {
    animation: float-4 4.5s ease-in-out infinite 1.5s;
  }

  .animate-float-5 {
    animation: float-5 5.5s ease-in-out infinite 2s;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    #lore-panel {
      position: relative !important;
      top: auto !important;
      left: auto !important;
      margin: 0.5rem;
      z-index: 60;
      padding: 0.5rem;
      font-size: 0.6rem;
      line-height: 1.3;
    }
    
    /* Disable typing animation on mobile and allow text wrapping */
    .typing-text {
      white-space: normal !important;
      animation: none !important;
      border-right: none !important;
      overflow: visible !important;
    }
    
    .typing-text p {
      margin-bottom: 0.75rem;
      word-wrap: break-word;
      hyphens: auto;
    }
    
    .goat-window {
      width: calc(100vw - 2rem) !important;
      height: 200px !important;
      position: relative !important;
      margin-bottom: 1rem;
      animation: none !important;
    }
    
    .fixed.inset-4 {
      position: relative !important;
      inset: 0 !important;
      padding: 1rem;
      overflow-y: auto;
      max-height: calc(100vh - 200px);
      display: flex;
      flex-direction: column;
    }
    
    .goat-window.absolute {
      position: relative !important;
      top: auto !important;
      left: auto !important;
      right: auto !important;
      bottom: auto !important;
      transform: none !important;
    }
    
    .animate-goat-1, .animate-goat-2 {
      display: none;
    }
  }
</style>

<script>
  // GOAT-OS Desktop Interactive Script
  
  // GOAT Window Functions
  function closeGoatWindow(button) {
    const window = button.closest('.goat-window');
    if (window) {
      window.style.display = 'none';
    }
  }



  // Other Desktop Functions
  function openTrollFiles() {
    alert('🎭 Troll Files: Coming Soon! Prepare for maximum chaos!');
  }

  function openInternet() {
    alert('🌐 Meme Web: Connecting to the dankest corners of the internet...');
  }

  function triggerEasterEgg() {
    const audio = new Audio('/goat.mp3');
    
    // Set start time when audio metadata is loaded
    audio.addEventListener('loadedmetadata', () => {
      audio.currentTime = 5; // Start from 4 seconds
    });
    
    audio.play();
    
    // Create floating goat explosion
    for (let i = 0; i < 10; i++) {
      setTimeout(() => {
        const goat = document.createElement('img');
        goat.src = '/dancing-goat.gif';
        goat.className = 'fixed w-16 h-16 pointer-events-none z-50';
        goat.style.left = Math.random() * window.innerWidth + 'px';
        goat.style.top = Math.random() * window.innerHeight + 'px';
        goat.style.animation = 'goatFloat1 3s ease-out forwards';
        
        document.body.appendChild(goat);
        
        setTimeout(() => goat.remove(), 3000);
      }, i * 100);
    }
    
    // Show secret message
    setTimeout(() => {
      alert('🐐 EASTER EGG ACTIVATED! You found the legendary GOAT! Meme level increased to LEGENDARY!');
    }, 1000);
  }

  // Background music
  let backgroundMusic;
  
  function playBackgroundMusic() {
    if (backgroundMusic) return; // Prevent multiple instances
    
    backgroundMusic = new Audio('/goat.mp3');
    backgroundMusic.loop = true;
    backgroundMusic.volume = 0.3;
    
    // Set start time when audio metadata is loaded
    backgroundMusic.addEventListener('loadedmetadata', () => {
      backgroundMusic.currentTime = 5; // Start from 4 seconds
    });
    
    // Try to play immediately
    backgroundMusic.play().catch(() => {
      // If autoplay is blocked, play on first user interaction
      document.addEventListener('click', () => {
        backgroundMusic.currentTime = 5; // Ensure it starts from 4 seconds
        backgroundMusic.play();
      }, { once: true });
    });
  }

  // Event Listeners
  document.addEventListener('DOMContentLoaded', () => {
    // Music will be started by login component, not automatically here
  });

  // Communication Hub Functions removed - now handled through ApplicationWindows system

  // Make functions globally available
  (window as any).closeGoatWindow = closeGoatWindow;
  (window as any).openTrollFiles = openTrollFiles;
  (window as any).openInternet = openInternet;
  (window as any).triggerEasterEgg = triggerEasterEgg;
  (window as any).playBackgroundMusic = playBackgroundMusic;
  // openCommunicationHub removed - now handled through ApplicationWindows system
</script>