---
// GOAT-OS Desktop Component - Greatest OS All Time
import Taskbar from './Taskbar.astro';
import StartMenu from './StartMenu.astro';
import ApplicationWindows from './ApplicationWindows.astro';
---

<!-- GOAT-OS Main Desktop - Retro Memecoin Operating System -->
<div id="main-screen" class="hidden min-h-screen bg-[url('/goat.gif')] bg-left bg-cover w-screen relative overflow-hidden">
  
  <!-- Dynamic Background with Floating Goats -->
  <div class="absolute inset-0 overflow-hidden">
    <img src="/dancing-goat.gif" class="absolute animate-goat-1 w-16 h-16 opacity-80" alt="Dancing Goat" />
    <img src="/goat.gif" class="absolute animate-goat-2 w-20 h-20 opacity-60" alt="Goat" />
  </div>

  <!-- GOAT-OS Lore Panel -->
  <div id="lore-panel" class="absolute top-4 left-4 bg-black/80 text-green-400 p-4 rounded-lg border border-green-500 max-w-md font-mono text-sm backdrop-blur-sm z-50">
    <div class="flex items-center mb-2">
      <img src="/goatos.png" class="w-8 h-8 mr-2" alt="GOAT-OS Logo" />
      <h2 class="text-lg font-bold text-yellow-400">GOAT-OS v1.337</h2>
    </div>
    <div class="typing-text">
      <p class="mb-2">Welcome to the Greatest Operating System of All Time!</p>
      <p class="mb-2">Born from the depths of memecoin culture, GOAT-OS represents the ultimate fusion of technology and chaos.</p>
      <p class="mb-2">Legend says this OS was coded by a legendary goat who achieved enlightenment through pure meme energy.</p>
      <p class="text-yellow-300">Current Meme Level: MAXIMUM</p>
    </div>
  </div>

  <!-- Desktop Icons Grid - REMOVED as requested -->

  <!-- GOAT GIF Windows -->
  <div class="fixed inset-4 pointer-events-none z-30 overflow-hidden">
    <!-- Goat Window 1 -->
    <div class="goat-window absolute top-4 right-4 w-64 h-48 bg-white border-2 border-black shadow-lg pointer-events-auto animate-float-1">
      <div class="bg-gray-200 border-b-2 border-black p-2 flex justify-between items-center">
        <span class="text-black font-bold text-sm">🌈 Psychedelic GOAT</span>
        <button onclick="closeGoatWindow(this)" class="text-black hover:text-red-600 font-bold">✕</button>
      </div>
      <div class="p-2 h-full flex items-center justify-center bg-gradient-to-br from-blue-100 to-purple-100">
        <img src="/goat.gif" alt="Classic GOAT" class="max-w-full max-h-full object-contain rounded" />
      </div>
    </div>

    <!-- Dancing Goat Window -->
    <div class="goat-window absolute top-64 right-4 w-64 h-48 bg-white border-2 border-black shadow-lg pointer-events-auto animate-float-2">
      <div class="bg-gray-200 border-b-2 border-black p-2 flex justify-between items-center">
        <span class="text-black font-bold text-sm">💃 Dancing GOAT</span>
        <button onclick="closeGoatWindow(this)" class="text-black hover:text-red-600 font-bold">✕</button>
      </div>
      <div class="p-2 h-full flex items-center justify-center bg-gradient-to-br from-pink-100 to-yellow-100">
        <img src="/dancing-goat.gif" alt="Dancing GOAT" class="max-w-full max-h-full object-contain rounded" />
      </div>
    </div>

    <!-- Goat2 Window -->
    <div class="goat-window absolute bottom-32 left-8 w-64 h-48 bg-white border-2 border-black shadow-lg pointer-events-auto animate-float-3">
      <div class="bg-gray-200 border-b-2 border-black p-2 flex justify-between items-center">
        <span class="text-black font-bold text-sm">🌟 GOAT Supreme</span>
        <button onclick="closeGoatWindow(this)" class="text-black hover:text-red-600 font-bold">✕</button>
      </div>
      <div class="p-2 h-full flex items-center justify-center bg-gradient-to-br from-green-100 to-blue-100">
        <img src="/goat2.gif" alt="GOAT Supreme" class="max-w-full max-h-full object-contain rounded" />
      </div>
    </div>

    <!-- Goat4 Window -->
    <div class="goat-window absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-48 bg-white border-2 border-black shadow-lg pointer-events-auto animate-float-4">
      <div class="bg-gray-200 border-b-2 border-black p-2 flex justify-between items-center">
        <span class="text-black font-bold text-sm">🚀 Mega GOAT</span>
        <button onclick="closeGoatWindow(this)" class="text-black hover:text-red-600 font-bold">✕</button>
      </div>
      <div class="p-2 h-full flex items-center justify-center bg-gradient-to-br from-orange-100 to-red-100">
        <img src="/goat4.gif" alt="Mega GOAT" class="max-w-full max-h-full object-contain rounded" />
      </div>
    </div>

    <!-- Troll Window -->
    <div class="goat-window absolute bottom-32 right-8 w-64 h-48 bg-white border-2 border-black shadow-lg pointer-events-auto animate-float-5">
      <div class="bg-gray-200 border-b-2 border-black p-2 flex justify-between items-center">
        <span class="text-black font-bold text-sm">😈 Troll GOAT</span>
        <button onclick="closeGoatWindow(this)" class="text-black hover:text-red-600 font-bold">✕</button>
      </div>
      <div class="p-2 h-full flex items-center justify-center bg-gradient-to-br from-purple-100 to-pink-100">
        <img src="/troll.gif" alt="Troll GOAT" class="max-w-full max-h-full object-contain rounded" />
      </div>
    </div>
  </div>



  <!-- Easter Egg: Secret Goat -->
  <div class="absolute bottom-20 left-10 cursor-pointer" onclick="triggerEasterEgg()">
    <img src="/goatos2.png" class="w-8 h-8 opacity-30 hover:opacity-100 transition-opacity" alt="Secret Goat" />
  </div>

  <!-- Taskbar -->
  <Taskbar />
  
  <!-- Start Menu -->
  <StartMenu />

</div>

<style>
  @keyframes goatMove {
    0% { left: -60px; }
    100% { left: calc(100% + 60px); }
  }

  @keyframes goatFloat1 {
    0% { transform: translate(0, 0) rotate(0deg); }
    25% { transform: translate(100px, -50px) rotate(90deg); }
    50% { transform: translate(200px, 0) rotate(180deg); }
    75% { transform: translate(100px, 50px) rotate(270deg); }
    100% { transform: translate(0, 0) rotate(360deg); }
  }

  @keyframes goatFloat2 {
    0% { transform: translate(100vw, 0) rotate(0deg); }
    25% { transform: translate(75vw, -100px) rotate(-90deg); }
    50% { transform: translate(50vw, 0) rotate(-180deg); }
    75% { transform: translate(25vw, 100px) rotate(-270deg); }
    100% { transform: translate(0, 0) rotate(-360deg); }
  }

  @keyframes trollBounce {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-20px) scale(1.1); }
  }

  @keyframes typing {
    from { width: 0; }
    to { width: 100%; }
  }

  .animate-goat {
    animation: goatMove 8s linear infinite;
  }

  .animate-goat-1 {
    animation: goatFloat1 15s ease-in-out infinite;
    top: 20%;
    left: 10%;
  }

  .animate-goat-2 {
    animation: goatFloat2 20s ease-in-out infinite;
    top: 60%;
    right: 10%;
  }

  .animate-troll {
    animation: trollBounce 3s ease-in-out infinite;
    top: 40%;
    left: 50%;
  }

  .typing-text {
    overflow: hidden;
    border-right: 2px solid #00ff00;
    white-space: nowrap;
    animation: typing 4s steps(40, end), blink-caret 0.75s step-end infinite;
  }

  @keyframes blink-caret {
    from, to { border-color: transparent; }
    50% { border-color: #00ff00; }
  }

  .desktop-icon:hover {
    transform: scale(1.1);
  }

  .desktop-icon {
    transition: transform 0.2s ease;
  }

  /* GOAT Window Animations */
  @keyframes float-1 {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-15px) rotate(2deg); }
  }

  @keyframes float-2 {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(-2deg); }
  }

  @keyframes float-3 {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(1deg); }
  }

  @keyframes float-4 {
    0%, 100% { transform: translate(-50%, -50%) translateY(0px) rotate(0deg); }
    50% { transform: translate(-50%, -50%) translateY(-25px) rotate(-1deg); }
  }

  @keyframes float-5 {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-18px) rotate(3deg); }
  }

  .animate-float-1 {
    animation: float-1 4s ease-in-out infinite;
  }

  .animate-float-2 {
    animation: float-2 5s ease-in-out infinite 0.5s;
  }

  .animate-float-3 {
    animation: float-3 6s ease-in-out infinite 1s;
  }

  .animate-float-4 {
    animation: float-4 4.5s ease-in-out infinite 1.5s;
  }

  .animate-float-5 {
    animation: float-5 5.5s ease-in-out infinite 2s;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    #lore-panel {
      position: relative !important;
      top: auto !important;
      left: auto !important;
      margin: 1rem;
      max-width: calc(100vw - 2rem);
      z-index: 60;
    }
    
    .goat-window {
      width: calc(100vw - 2rem) !important;
      height: 200px !important;
      position: relative !important;
      margin-bottom: 1rem;
      animation: none !important;
    }
    
    .fixed.inset-4 {
      position: relative !important;
      inset: 0 !important;
      padding: 1rem;
      overflow-y: auto;
      max-height: calc(100vh - 200px);
      display: flex;
      flex-direction: column;
    }
    
    .goat-window.absolute {
      position: relative !important;
      top: auto !important;
      left: auto !important;
      right: auto !important;
      bottom: auto !important;
      transform: none !important;
    }
    
    .animate-goat-1, .animate-goat-2 {
      display: none;
    }
  }
</style>

<script>
  // GOAT-OS Desktop Interactive Script
  
  // GOAT Window Functions
  function closeGoatWindow(button) {
    const window = button.closest('.goat-window');
    if (window) {
      window.style.display = 'none';
    }
  }

  // Gallery Functions
  function openGallery() {
    const gallery = document.getElementById('memeGallery');
    gallery.style.display = 'block';
    
    // Load all meme images from mypictures folder
    const galleryContent = document.querySelector('#memeGallery .window-content');
    const memeImages = [];
    
    // Add mypictures images
    for (let i = 1; i <= 15; i++) {
      memeImages.push(`/mypictures/${i}.jpeg`);
    }
    
    // Add GIF assets
    memeImages.push('/pepe.png', '/goat.gif', '/dancing-goat.gif', '/troll.gif');
    
    const imageGrid = memeImages.map(img => 
       `<img src="${img}" class="w-full h-32 object-cover rounded cursor-pointer hover:scale-105 transition-transform" onclick="viewImage('${img}')">`
     ).join('');
    
    galleryContent.innerHTML = `
      <div class="grid grid-cols-4 gap-3 p-4 max-h-96 overflow-y-auto">
        ${imageGrid}
      </div>
    `;
  }

  function closeGallery() {
    document.getElementById('gallery-window').classList.add('hidden');
  }

  function showFullImage(src) {
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50';
    modal.onclick = () => modal.remove();
    
    const img = document.createElement('img');
    img.src = src;
    img.className = 'max-w-full max-h-full object-contain';
    
    modal.appendChild(img);
    document.body.appendChild(modal);
  }

  // Other Desktop Functions
  function openTrollFiles() {
    alert('🎭 Troll Files: Coming Soon! Prepare for maximum chaos!');
  }

  function openInternet() {
    alert('🌐 Meme Web: Connecting to the dankest corners of the internet...');
  }

  function triggerEasterEgg() {
    const audio = new Audio('/goat.mp3');
    audio.play();
    
    // Create floating goat explosion
    for (let i = 0; i < 10; i++) {
      setTimeout(() => {
        const goat = document.createElement('img');
        goat.src = '/dancing-goat.gif';
        goat.className = 'fixed w-16 h-16 pointer-events-none z-50';
        goat.style.left = Math.random() * window.innerWidth + 'px';
        goat.style.top = Math.random() * window.innerHeight + 'px';
        goat.style.animation = 'goatFloat1 3s ease-out forwards';
        
        document.body.appendChild(goat);
        
        setTimeout(() => goat.remove(), 3000);
      }, i * 100);
    }
    
    // Show secret message
    setTimeout(() => {
      alert('🐐 EASTER EGG ACTIVATED! You found the legendary GOAT! Meme level increased to LEGENDARY!');
    }, 1000);
  }

  // Background music
  let backgroundMusic;
  
  function playBackgroundMusic() {
    if (backgroundMusic) return; // Prevent multiple instances
    
    backgroundMusic = new Audio('/goat.mp3');
    backgroundMusic.loop = true;
    backgroundMusic.volume = 0.3;
    
    // Try to play immediately
    backgroundMusic.play().catch(() => {
      // If autoplay is blocked, play on first user interaction
      document.addEventListener('click', () => {
        backgroundMusic.play();
      }, { once: true });
    });
  }

  // Event Listeners
  document.addEventListener('DOMContentLoaded', () => {
    // Music will be started by login component, not automatically here
  });

  // Make functions globally available
  (window as any).closeGoatWindow = closeGoatWindow;
  (window as any).openGallery = openGallery;
  (window as any).closeGallery = closeGallery;
  (window as any).showFullImage = showFullImage;
  (window as any).openTrollFiles = openTrollFiles;
  (window as any).openInternet = openInternet;
  (window as any).triggerEasterEgg = triggerEasterEgg;
  (window as any).playBackgroundMusic = playBackgroundMusic;
</script>